<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Filters Page</title>
    <link rel="stylesheet" href="filter-style.css" />
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/jquery/latest/jquery.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css" />
    
</head>
<body class="main">
        
    <header class="header">
        <nav class="nav">
            <a id="navigation" href="index.html" class="nav_logo">    
                <span style="color: #FFD700">Comfort</span>
                <span style="color: #807DFE">Country</span>
            </a>
            <!-- <a href="userprofile.html" class="profile_icon">
                <i class="uil uil-user-circle"></i>
            </a> -->
            <button class="button" id="form-open">Log in</button>
        </nav>
    
    </header>

    <div class="search_box">
        <div class="search_section">
            <select id="town_select">
                <!-- <option value="" disabled selected hidden>Choose region</option> -->
    
            <option value="663564ca241db4d6acb04742">Волинська область</option><option value="6635658788b343c65e33f5fe">Дніпропетровська область</option><option value="66355b2ec36bb04480610ceb">Вінницька область</option><option value="6635662588b343c65e33f601">Донецька область</option><option value="6635666588b343c65e33f604">Житомирська область</option><option value="66360c544a02c9aa56a3b645">Закарпатська область</option><option value="66360e19550e8812f6b832dd">Запорізька область</option><option value="66360e46550e8812f6b832e0">Івано-Франківська область</option><option value="66360eb1550e8812f6b832e2">Київська область</option><option value="66360ef2550e8812f6b832e5">Кіровоградська область</option><option value="66360fbfd2cbc5c25bd5b711">Луганська область</option><option value="66361020d2cbc5c25bd5b714">Львівська область</option><option value="66361056d2cbc5c25bd5b716">Миколаївська область</option><option value="663610bad2cbc5c25bd5b719">Одеська область</option><option value="66361210d2cbc5c25bd5b71f">Полтавська область</option><option value="663612af5e68d1b883aecf51">Рівненська область</option><option value="663612f35e68d1b883aecf54">Сумська область</option><option value="663613185e68d1b883aecf56">Тернопільська область</option><option value="663613425e68d1b883aecf58">Харківська область</option><option value="6636138b5e68d1b883aecf5a">Херсонська область</option><option value="663613d35e68d1b883aecf5c">Хмельницька область</option><option value="663617a0736e9a3d5a0c80c9">Черкаська область</option><option value="66361856736e9a3d5a0c80cb">Чернівецька область</option><option value="66361873736e9a3d5a0c80cd">Чернігівська область</option></select>
        </div>
        <div class="divider"></div>
        <div class="search_section">
            <label> Check in - Check out</label>
            <input type="text" name="dates" />
        </div>
        <div class="divider"></div>
        <div class="search_section">
            <span>Hotel Type:</span>
            <select id="Type">
                <option value="" disabled selected hidden>Choose type</option>
                <option value="готель">Готель</option>
                <option value="апартаменти">Апартаменти</option>
                <option value="гостьовий будинок">Гостьовий будинок</option>
                <!-- Додайте інші варіанти для кількості гостей -->
            </select>
        </div>
        
        <div class="search_section">
            <span>Hotel Stars</span>
        <select id="stars">
            <option value="" disabled selected hidden>Choose star amount</option>
            <option value="1">1-★</option>
            <option value="2">2-★★</option>
            <option value="3">3-★★★</option>
            <option value="4">4-★★★★</option>
            <option value="5">5-★★★★★</option>
            <!-- Додайте інші варіанти для кількості кімнат -->
        </select>
        </div>    
        <div class="divider"></div>
        <div class="search_section">
            <button class="search_button" onclick="redirectToFilterPage()">Search</button>
        </div>
    </div>
    <script>
        function redirectToFilterPage() {
            console.log("ok")
    // Отримання значень вибраних елементів
    var townSelect = document.getElementById("town_select").value;
    var typeSelect = document.getElementById("Type").value;
    var starsSelect = document.getElementById("stars").value;
    console.log(localStorage.token)
   // Формування URL з вибраними значеннями
    var url = "filter-page.html?";
        if (townSelect) url += "Rid=" + townSelect + "&";
        if (typeSelect) url += "type=" + typeSelect + "&";
        if (starsSelect) url += "stars=" + starsSelect+"&";
        if (localStorage.token) url += "token=" + localStorage.token+"&";
        // Перенаправлення на сторінку зі збереженими параметрами
        
         window.location.href = url;


}
    </script>
    
    <div class="add-banner">
        <div class="add-banner-cont">
            <a>Найпопулярніші курортні міста:</a>
        </div>
        <div class="add-banner-cont">
            <a>Найпопулярніші курортні міста:</a>
        </div>
        <div class="add-banner-cont">
            <a>Тут може бути ваша реклама:</a>
        </div>
    </div>

    <div class="all-hotels">
        <!-- <div class="hotel-menu">
            <div class="photo-container">
                <img class="hotel-photo" src="Київська обл.jpg">
            </div>
            <div class="name-hotel">
                <div class="name-hotel-cont">
                    <a>Готель Skylinesfds fsdівфівфів</a>
                </div>
                <div class="description">
                    <a style="font-size: small;">Treasured for its surrounding beaches, azure blue water and a picturesque yacht paradise, The Pier Hotel is a little slice of paradise in “the back garden of Hong Kong”, Sai Kung. Escape to a private haven at The Pier Hotel where the pace of life is slow and the scenery is simply breathtaking.</a>
                </div>
            </div>
            <div class="star-pick">
                <div class="marks">
                    <a>Stars:</a>
                    <div class="star-pick-mark">5</div>
                    <button onclick="window.location.href = 'showhotel.html';">Перейти</button>
                </div>
                <div class="location">
                    <ul style="list-style-type: none; margin-top: 15px;">
                        <li><strong>Область:</strong> Хмельницька область</li>
                        <li><strong>Місто:</strong> Хмельницький</li>
                        <li><strong>Адреса:</strong> вул. Незалежності, 123</li>
                        <li><strong>Тип помешкання:</strong> готель</li>
                    </ul>
                </div>
            </div>
        </div> -->
        <div id="hotels-container"></div>
        
       
    </div>
    <div class="filters">
        <h2 style="color: #FFD700; margin-top: 5px;">Filters:</h1>
        
        <h4 style=" margin-top: 5px; color: white;">Stars:</4>
            <select class="filters-container" id="regions" name="regions" multiple>
                <option value="1">1-★</option>
                <option value="2">2-★★</option>
                <option value="3">3-★★★</option>
                <option value="4">4-★★★★</option>
                <option value="5">5-★★★★★</option>
            </select>
        <h4 style=" margin-top: 5px; color: white;">Town:</4>
            <select class="filters-container" id="cities" name="cities" multiple>
            </select>
        <h4 style=" margin-top: 5px; color: white;">Type of accommodation:</4>
        <div>
            <select  class="filters-container" id multiple>
                
                <option value="готель">Готель</option>
                <option value="апартаменти">Апартаменти</option>
                <option value="гостьовий будинок">Гостьовий будинок</option>
        </select>
        </div>

        <button class="filter-accept">Accept</button>

    </div>

    <script>
        $(function() {
          $('input[name="daterange"]').daterangepicker({
            opens: 'left'
          }, function(start, end, label) {
            console.log("A new date selection was made: " + start.format('YYYY-MM-DD') + ' to ' + end.format('YYYY-MM-DD'));
          });
        });
        document.addEventListener("DOMContentLoaded", function () {
            const urlParams = new URLSearchParams(window.location.search);
            const token = urlParams.get('token');
            
            if (token) {
                document.getElementById('navigation').href += '?token=' + token;
            }
        });
        document.addEventListener('DOMContentLoaded', function() {
    // Отримуємо URL
    var urlParams = new URLSearchParams(window.location.search);
    // Перевіряємо, чи присутній токен
    const token = urlParams.get('token');
    
    if (urlParams.has('token')) {
        // Видаляємо елемент з id "form-open"
        var formOpenButton = document.getElementById('form-open');
        if (formOpenButton) {
            formOpenButton.remove();
        }
        // Додаємо вашу потрібну структуру замість кнопки
        var nav = document.querySelector('.nav');
        
        if (nav) {
            var profileLink = document.createElement('a');
            profileLink.href = 'user.html?token='+token;
            profileLink.classList.add('profile_icon');

            var userIcon = document.createElement('i');
            userIcon.classList.add('uil', 'uil-user-circle');

            profileLink.appendChild(userIcon);
            nav.appendChild(profileLink);
        }
        // Додаємо CSS правило для приховування елемента з класом .profile_icon
        var style = document.createElement('style');
        style.innerHTML = '.profile_icon { display: flex; }';
        document.head.appendChild(style);
    }
});
    document.addEventListener('DOMContentLoaded', displayhotels);
    async function displayhotels() {
    try {
        const urlParams = new URLSearchParams(window.location.search);
        const regions = await fetchRegion(); // Отримуємо області з сервера
        const Type=urlParams.get('type');
        const star=urlParams.get('stars');
        
        console.log(regions)
        console.log(Type)
        console.log(star)
        
        const hotels=await axios.post('api/main/GetHotels',{
            Region_name:regions,
            Type:Type,
            Stars:star
        });
        
        const hotelsContainer = document.getElementById('hotels-container');
        
        
        
        // Зацикліться через кожен готель у масиві готелів
        hotels.data.hotels.forEach(hotel => {
        const photoData = new Uint8Array(hotel.Photo.data.data);
        const blob = new Blob([photoData], { type: 'image/jpeg' });
        const imageUrl = URL.createObjectURL(blob);

        // Створення елементів для готеля
        const hotelMenu = document.createElement('div');
        hotelMenu.classList.add('hotel-menu');

        const photoContainer = document.createElement('div');
        photoContainer.classList.add('photo-container');

        const imgElement = document.createElement('img');
        imgElement.classList.add('hotel-photo');
        imgElement.src = imageUrl;
        imgElement.alt = hotel.Hotel_Name;
        photoContainer.appendChild(imgElement);

        const nameHotel = document.createElement('div');
        nameHotel.classList.add('name-hotel');

        const nameHotelCont = document.createElement('div');
        nameHotelCont.classList.add('name-hotel-cont');
        const hotelName = document.createElement('a');
        hotelName.textContent = hotel.Hotel_Name;
        nameHotelCont.appendChild(hotelName);
        nameHotel.appendChild(nameHotelCont);

        const description = document.createElement('div');
        description.classList.add('description');
        const descText = document.createElement('a');
        descText.style.fontSize = 'small';
        descText.textContent = hotel.Description;
        description.appendChild(descText);
        nameHotel.appendChild(description);
        
        const starPick = document.createElement('div');
        starPick.classList.add('star-pick');
        const mark=document.createElement('div');
        mark.classList.add("marks")
        const starsLabel = document.createElement('a');
        starsLabel.textContent = 'Stars:';
        mark.appendChild(starsLabel);
        const starPickMark = document.createElement('div');
        starPickMark.classList.add('star-pick-mark');
        starPickMark.textContent = hotel.Stars;
        mark.appendChild(starPickMark);
        const urlParams = new URLSearchParams(window.location.search);
            const token = urlParams.get('token');
        const button = document.createElement('button');
        button.textContent = 'Перейти';
        if(token){
            button.onclick = function() {
            window.location.href = 'showhotel.html?Hid='+hotel._id+"&token="+token;
            };
        }else{
            button.onclick = function() {
            window.location.href = 'showhotel.html?Hid='+hotel._id;
        };
        }
        mark.appendChild(button);
        starPick.appendChild(mark)
        const location = document.createElement('div');
        location.classList.add('location');
        const ul = document.createElement('ul');
        ul.style.listStyleType = 'none';
        ul.style.marginTop = '15px';
        const regionLi = document.createElement('li');
        regionLi.innerHTML = `<strong>Region:</strong> ${hotel.Region}`;
        const cityLi = document.createElement('li');
        cityLi.innerHTML = `<strong>City:</strong> ${hotel.City}`;
        const addressLi = document.createElement('li');
        addressLi.innerHTML = `<strong>Address:</strong> ${hotel.Location}`;
        const hotelTypeLi = document.createElement('li');
        hotelTypeLi.innerHTML = `<strong>Hotel type:</strong> ${hotel.Hotel_type}`;
        ul.appendChild(regionLi);
        ul.appendChild(cityLi);
        ul.appendChild(addressLi);
        ul.appendChild(hotelTypeLi);
        location.appendChild(ul);
        starPick.appendChild(location);

        // Додавання створених елементів до контейнера готелів
        hotelMenu.appendChild(photoContainer);
        hotelMenu.appendChild(nameHotel);
        hotelMenu.appendChild(starPick);
        // hotelMenu.appendChild(location);

        const hotelsContainer = document.getElementById('hotels-container');
        hotelsContainer.appendChild(hotelMenu);
    });



       
    } catch (error) {
        console.error('Error displaying regions:', error);
    }
}

async function fetchRegion() {
    
    const urlParams = new URLSearchParams(window.location.search);
    const Reg_id = urlParams.get('Rid');
   
    
    try {
        
        const response = await axios.post('api/main/getRegioname',{
            Reg_id:Reg_id
        });
        var City_names = response.data.uniqueCities;
        const select = document.getElementById('cities');
        City_names.forEach(city => {
            const option = document.createElement('option');
            option.value = city;
            option.textContent = city; 
            select.appendChild(option);
            
        });
        
        
        var reg_name=response.data.region_name
        return reg_name
      
        
    } catch (error) {
        console.error('Error fetching regions:', error);
        return [];
    }
}

    </script>
    
    <script src="filter-script.js"></script>
</body>
</html>