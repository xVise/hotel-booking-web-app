<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Profile</title>
    <link rel="stylesheet" href="userstyle2.css">
    <link rel="stylesheet" href="https://unicons.iconscout.com/release/v4.0.0/css/line.css">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body>

<header class="header">
    <nav class="nav">
        <a id="navLogoLink" href="index.html" class="nav_logo">ComfortCountry</a>
    </nav>
</header>

<div class="main">
    <div class="photo"></div>

    <input class="edit_profile" type="button" id="edit_profile" value="Edit profile" onclick="enableEditing()">
    <input class="edit_profile" type="button" id="save_changes" value="Save changes" onclick="saveChanges()" style="display:none">

    <div class="info">
        <label for="first_name_input">Name:</label>
        <input type="text" id="first_name_input" name="first_name" readonly>
        <label for="surname_input">Surname:</label>
        <input type="text" id="surname_input" name="surname" readonly>
        <label for="phoneNumber_input">Phone Number:</label>
        <input type="text" id="phoneNumber_input" name="phoneNumber" readonly>
        <label for="sex_input">Sex:</label>
        <input type="text" id="sex_input" name="sex" readonly>
        <label for="dob_input">Date of Birth:</label>
        <input type="text" id="dob_input" name="dob" readonly>
        <label for="country_input">Country:</label>
        <input type="text" id="country_input" name="country" readonly>
        <label for="email_input">Email:</label>
        <input type="text" id="email_input" name="email" readonly>
    </div>
    <button class="log_out" onclick="logout()">Log out</button>
    
</div>

<script>
    function logout(){
        window.location.href = 'index.html';
    }

    const urlParams = new URLSearchParams(window.location.search);
    const token = urlParams.get('token');

    if (token) {
        axios.get('api/user/users', {
            headers: {
                Authorization: 'Bearer ' + token
            }
        }).then(function (response) {
            const userInfo = response.data;
            console.log(userInfo);
            document.getElementById('first_name_input').value = userInfo.First_Name;
            document.getElementById('surname_input').value = userInfo.Last_Name;
            document.getElementById('phoneNumber_input').value = userInfo.Phone_Number;
            document.getElementById('sex_input').value = userInfo.Gender;
            document.getElementById('dob_input').value = userInfo.Date;
            document.getElementById('country_input').value = userInfo.Country;
            document.getElementById('email_input').value = userInfo.EMail;
        }).catch(function (error) {
            console.error('Error fetching user profile:', error);
        });
    } else {
        console.error('Token not found in URL.');
    }

    // Function to enable editing of input fields
    function enableEditing() {
        var inputs = document.querySelectorAll('input[readonly]');
        for (var i = 0; i < inputs.length; i++) {
            inputs[i].readOnly = false;
        }
        document.getElementById('edit_profile').style.display = 'none';
        document.getElementById('save_changes').style.display = 'block';
    }

    // Function to save changes
    async function saveChanges() {
        var inputs = document.querySelectorAll('input[readonly]');
        for (var i = 0; i < inputs.length; i++) {
            inputs[i].readOnly = true;
        }
        const firstName = document.getElementById("first_name_input").value;
        const lastName = document.getElementById("surname_input").value;
        const sex = document.getElementById("sex_input").value;
        const bDate = document.getElementById("dob_input").value;
        const telephone = document.getElementById("phoneNumber_input").value;
        const country = document.getElementById("country_input").value;
        const email = document.getElementById("email_input").value;
        console.log(email);
        document.getElementById('save_changes').style.display = 'none';
        document.getElementById('edit_profile').style.display = 'block';
        const urlParams = new URLSearchParams(window.location.search);
        const token = urlParams.get('token');

        await axios.post('api/user/Updateinfo', {


            firstName: firstName,
            lastName: lastName,
            sex: sex,
            bDate: bDate,
            telephone: telephone,
            country: country,
            EMail: email,
            Authorization:  token,
            }).then(function (response){
                console.log("ok")
        });
        alert('Changes successfully saved!');
    }

    document.addEventListener("DOMContentLoaded", function() {
        const urlParams = new URLSearchParams(window.location.search);
        const token = urlParams.get('token');
        if (token) {
            document.getElementById('navLogoLink').href += '?token=' + token;
        }
    });
</script>

<script>
    function displayProfilePicture(input) {
        if (input.files && input.files[0]) {
            var reader = new FileReader();
            reader.onload = function (e) {
                document.getElementById('profile_picture').setAttribute('src', e.target.result);
            }
            reader.readAsDataURL(input.files[0]);
        }
    }

    // Event handler for uploading profile picture
    document.getElementById('profile_picture_input').addEventListener('change', function() {
        displayProfilePicture(this);
    });
</script>


</body>
</html>
